{% extends "base.html" %}

{% block title %}{{ box.name }} - Garage Inventory{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card shadow mb-4">
            <div class="card-header bg-primary text-white">
                <h2 class="mb-0">{{ box.name }}</h2>
            </div>
            <div class="card-body">
                <!-- Box Image -->
                {% if box.image_path %}
                <div class="mb-3 text-center">
                    <img src="/{{ box.image_path }}" alt="{{ box.name }}" class="img-fluid rounded" style="max-height: 300px;">
                </div>
                {% endif %}
                <p><strong>üéØ Position:</strong> {{ box.location or 'Not specified' }}</p>
                <p><strong>üìù Description:</strong> {{ box.description or 'No description' }}</p>
                <p><strong>üì¶ Total Items:</strong> {{ box.item_count() }}</p>
                <p><strong>üí∑ Total Value:</strong> ¬£{{ "%.2f"|format(box.total_value()) }}</p>
            </div>
            <div class="card-footer">
                <a href="{{ url_for('edit_box', box_id=box.id) }}" class="btn btn-warning">Edit Box</a>
                <form method="POST" action="{{ url_for('delete_box', box_id=box.id) }}" style="display:inline;">
                    <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure?')">Delete Box</button>
                </form>
                <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">Back to Boxes</a>
            </div>
        </div>
    </div>
    
       <div class="col-md-4">
        <div class="card shadow mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">QR Code</h5>
            </div>
            <div class="card-body text-center">
                {% if box.qr_code_path %}
                    <img src="/{{ box.qr_code_path }}" alt="QR Code for {{ box.name }}" class="img-fluid" style="max-width: 300px;">
                    <br>
                    <a href="/{{ box.qr_code_path }}" download class="btn btn-sm btn-success mt-3">üì• Download QR Code</a>
                {% else %}
                    <p class="text-muted">QR Code will be generated when you save the box.</p>
                {% endif %}
            </div>
        </div>
    </div>

</div>

<!-- Items Section -->
<div class="row mt-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3>Items in This Box</h3>
            <a href="{{ url_for('create_item', box_id=box.id) }}" class="btn btn-success">‚ûï Add Item</a>
        </div>
        
        {% if box.items %}
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>Name</th>
                            <th>Qty</th>
                            <th>Category</th>
                            <th>Value (¬£)</th>
                            <th>Notes</th>
                            <th>Edit</th>
                            <th>Delete</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in box.items %}
                        <tr>
                            <td>{{ item.name }}</td>
                            <td>{{ item.quantity }}</td>
                            <td>{{ item.category or '‚Äî' }}</td>
                            <td>¬£{{ "%.2f"|format(item.value) }}</td>
                            <td>{{ item.notes[:50] if item.notes else '‚Äî' }}</td>
                            <td>
                                <a href="{{ url_for('edit_item', item_id=item.id) }}" class="btn btn-sm btn-warning">
                                    ‚úèÔ∏è Edit
                                </a>
                            </td>
                            <td>
                                <form method="POST" action="{{ url_for('delete_item', item_id=item.id) }}" style="display:inline;">
                                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this item? This action cannot be undone.')">
                                        üóëÔ∏è Delete
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="alert alert-info">
                <p class="mb-0">No items in this box yet. Click the "Add Item" button to add one!</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
